<FULL CODE FROM EARLIER RESPONSE>